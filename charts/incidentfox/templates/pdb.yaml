{{- /*
PodDisruptionBudgets (optional per service).
*/ -}}

{{- if and .Values.services.configService.enabled .Values.services.configService.pdb.enabled }}
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: incidentfox-config-service
  namespace: {{ .Values.namespace }}
spec:
  minAvailable: {{ .Values.services.configService.pdb.minAvailable }}
  selector:
    matchLabels:
      app: incidentfox-config-service
{{- end }}

{{- if and .Values.services.orchestrator.enabled .Values.services.orchestrator.pdb.enabled }}
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: incidentfox-orchestrator
  namespace: {{ .Values.namespace }}
spec:
  minAvailable: {{ .Values.services.orchestrator.pdb.minAvailable }}
  selector:
    matchLabels:
      app: incidentfox-orchestrator
{{- end }}

{{- if and .Values.services.agent.enabled .Values.services.agent.pdb.enabled }}
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: incidentfox-agent
  namespace: {{ .Values.namespace }}
spec:
  minAvailable: {{ .Values.services.agent.pdb.minAvailable }}
  selector:
    matchLabels:
      app: incidentfox-agent
{{- end }}

{{- if and .Values.services.aiPipelineApi.enabled .Values.services.aiPipelineApi.pdb.enabled }}
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: incidentfox-ai-pipeline-api
  namespace: {{ .Values.namespace }}
spec:
  minAvailable: {{ .Values.services.aiPipelineApi.pdb.minAvailable }}
  selector:
    matchLabels:
      app: incidentfox-ai-pipeline-api
{{- end }}

{{- if and .Values.services.webUi.enabled .Values.services.webUi.pdb.enabled }}
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: incidentfox-web-ui
  namespace: {{ .Values.namespace }}
spec:
  minAvailable: {{ .Values.services.webUi.pdb.minAvailable }}
  selector:
    matchLabels:
      app: incidentfox-web-ui
{{- end }}

{{- if and .Values.services.k8sGateway.enabled .Values.services.k8sGateway.pdb.enabled }}
---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: incidentfox-k8s-gateway
  namespace: {{ .Values.namespace }}
spec:
  minAvailable: {{ .Values.services.k8sGateway.pdb.minAvailable }}
  selector:
    matchLabels:
      app: incidentfox-k8s-gateway
{{- end }}


