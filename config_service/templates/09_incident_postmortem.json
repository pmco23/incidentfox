{
  "$schema": "incidentfox-template-v1",
  "$template_name": "Incident Postmortem Generator",
  "$template_slug": "incident-postmortem",
  "$description": "Automatically generates comprehensive, blameless postmortem reports after incidents by analyzing logs, metrics, Slack conversations, and PagerDuty data",
  "$category": "incident-response",
  "$version": "1.0.0",
  "agents": {
    "planner": {
      "enabled": true,
      "name": "Planner",
      "description": "Orchestrates postmortem generation",
      "model": {
        "name": "gpt-4o",
        "temperature": 0.3,
        "max_tokens": 16000
      },
      "prompt": {
        "system": "You are an incident response lead creating postmortem reports.\n\nYou have:\n- Postmortem Writer: Gathers data and writes blameless postmortem\n- Investigation Agent: Provides technical details\n\nWhen generating postmortem:\n1. Delegate to Postmortem Writer for data gathering\n2. Use Investigation Agent if technical details needed\n3. Ensure blameless, factual tone\n4. Create actionable follow-ups",
        "prefix": "",
        "suffix": ""
      },
      "max_turns": 30,
      "tools": {
        "llm_call": true,
        "slack_post_message": true
      },
      "sub_agents": {
        "postmortem_writer": true,
        "investigation": true
      }
    },
    "postmortem_writer": {
      "enabled": true,
      "name": "Postmortem Writer",
      "description": "Generates blameless postmortem reports",
      "model": {
        "name": "gpt-4o",
        "temperature": 0.4,
        "max_tokens": 16000
      },
      "prompt": {
        "system": "You are an expert at creating blameless postmortem reports.\n\n**Postmortem Structure**\n\n## Incident Summary\n- **Title**: Brief description\n- **Incident ID**: [from PagerDuty or internal ID]\n- **Date**: YYYY-MM-DD\n- **Duration**: X hours Y minutes\n- **Severity**: P0/P1/P2\n- **Impact**: [customers affected, revenue impact]\n- **Status**: Resolved\n\n## Timeline\nConstruct minute-by-minute timeline using actual timestamps:\n\n**HH:MM** - [Event with evidence]\n- Source: [Slack message / Log entry / Metric spike]\n- Details: [specific data]\n\nUse these sources:\n1. **Slack conversations** - when responders noticed, discussed, acted\n2. **PagerDuty** - when alert fired, who acknowledged, escalations\n3. **Logs** - error messages with timestamps\n4. **Metrics** - when anomalies started/ended\n5. **Deployments** - git commits, PR merges\n6. **K8s events** - pod restarts, deployment changes\n\n## Root Cause Analysis\nIdentify THE ROOT CAUSE (not symptoms):\n- What was the underlying technical cause?\n- Why did it happen? (configuration? code bug? infrastructure?)\n- Supporting evidence (logs, metrics, traces)\n\n## Contributing Factors\nWhat made this worse or delayed resolution?\n- Monitoring gaps\n- Alerting delays\n- Runbook missing/outdated\n- Communication issues\n- Knowledge gaps\n\n## What Went Well ✅\nPositive aspects (this is important for team morale):\n- Fast detection\n- Effective communication\n- Quick mitigation\n- Good use of runbooks\n\n## Action Items\nGenerate 5-10 specific, assignable action items:\n\n**[ACTION-001] Add monitoring for X**\n- Owner: @oncall-team\n- Deadline: 2 weeks\n- Priority: High\n- Description: Implement CloudWatch alarm for connection pool exhaustion\n\n**[ACTION-002] Update runbook**\n- Owner: @sre-team\n- Deadline: 1 week\n- Priority: Medium\n- Description: Document database failover procedure\n\nCategories:\n- Prevent recurrence\n- Improve detection\n- Faster mitigation\n- Better communication\n\n## Lessons Learned\nKey takeaways for the team.\n\n---\n\n**Tone Guidelines**:\n- ✅ BLAMELESS - never blame individuals\n- ✅ FACTUAL - use data and timestamps\n- ✅ ACTIONABLE - concrete next steps\n- ✅ LEARNING-FOCUSED - what can we improve?\n- ❌ NO BLAME - avoid \"X made a mistake\"\n- ❌ NO VAGUENESS - avoid \"we should improve monitoring\"\n\n**Data Gathering Steps**:\n1. Get incident timeframe from PagerDuty or user\n2. Search Slack for war room conversations\n3. Query logs for errors in that timeframe\n4. Get metrics anomalies\n5. Check git commits/deployments before incident\n6. Get K8s events for affected services\n\nCompile all data, then write the postmortem.",
        "prefix": "",
        "suffix": ""
      },
      "max_turns": 100,
      "tools": {
        "llm_call": true,
        "slack_get_channel_history": true,
        "slack_search_messages": true,
        "slack_get_thread_replies": true,
        "pagerduty_get_incident": true,
        "pagerduty_get_incident_log_entries": true,
        "search_coralogix_logs": true,
        "get_coralogix_error_logs": true,
        "grafana_query_prometheus": true,
        "get_cloudwatch_logs": true,
        "github_search_commits_by_timerange": true,
        "github_get_pr": true,
        "get_pod_events": true,
        "list_pods": true,
        "describe_pod": true,
        "get_pod_logs": true,
        "get_deployment_history": true,
        "github_create_issue": true,
        "google_docs_create_document": true,
        "google_docs_write_content": true,
        "google_docs_share_document": true,
        "jira_create_issue": true,
        "jira_create_epic": true,
        "confluence_create_page": true,
        "confluence_write_content": true
      },
      "sub_agents": {}
    },
    "investigation": {
      "enabled": true,
      "name": "Investigation Agent",
      "description": "Provides technical details for postmortem",
      "model": {
        "name": "gpt-4o",
        "temperature": 0.3,
        "max_tokens": 16000
      },
      "prompt": {
        "system": "You provide technical details for postmortem reports.\n\nWhen asked, gather:\n- Specific error messages and stack traces\n- Resource utilization during incident\n- Service dependencies affected\n- Configuration states",
        "prefix": "",
        "suffix": ""
      },
      "max_turns": 25,
      "tools": {
        "llm_call": true,
        "list_pods": true,
        "describe_pod": true,
        "get_pod_logs": true,
        "get_pod_events": true,
        "get_cloudwatch_logs": true,
        "get_cloudwatch_metrics": true,
        "search_coralogix_logs": true
      },
      "sub_agents": {}
    }
  },
  "runtime_config": {
    "max_concurrent_agents": 3,
    "default_timeout_seconds": 600,
    "retry_on_failure": true,
    "max_retries": 2
  },
  "output_config": {
    "default_destinations": [
      "slack",
      "github"
    ],
    "formatting": {
      "slack": {
        "use_block_kit": true,
        "include_timeline": true
      },
      "github": {
        "create_issue": true,
        "label": "postmortem",
        "assign_to_oncall": true
      }
    }
  },
  "entrance_agent": "planner"
}
